<div class="article-container">
  <div class="header">
    <h2>Articles Management</h2>
    <button *ngIf="authService.isAdmin()" class="btn btn-primary" (click)="openCreateModal()">
      + Add Article
    </button>
  </div>

  <div class="search-bar">
    <input
      type="text"
      [(ngModel)]="searchTerm"
      (input)="searchArticles()"
      placeholder="Search articles by name..."
      class="search-input"
    />
  </div>

  <div *ngIf="error" class="alert alert-error">{{ error }}</div>
  <div *ngIf="loading" class="loading">Loading articles...</div>

  <div *ngIf="!loading && filteredArticles.length === 0" class="no-data">
    No articles found.
  </div>

  <div *ngIf="!loading && filteredArticles.length > 0" class="table-container">
    <table>
      <thead>
        <tr>
          <th>Designation</th>
          <th>Quantity</th>
          <th>Stock Status</th>
          <th>Price</th>
          <th *ngIf="authService.isAdmin()">Total Value</th>
          <th *ngIf="authService.isAdmin()">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let article of filteredArticles">
          <td>{{ article.designation }}</td>
          <td>{{ article.quantite }}</td>
          <td>
            <span class="stock-badge" [ngClass]="{
              'in-stock': article.quantite >= 10,
              'low-stock': article.quantite > 0 && article.quantite < 10,
              'out-of-stock': article.quantite === 0
            }">
              {{ getStockStatus(article) }}
            </span>
          </td>
          <td>{{ article.prix | number : "1.2-2" }} TND</td>
          <td *ngIf="authService.isAdmin()">{{ article.prix * article.quantite | number : "1.2-2" }} TND</td>
          <td *ngIf="authService.isAdmin()">
            <div class="actions">
              <button class="btn btn-warning" (click)="openEditModal(article)">
                Edit
              </button>
              <button
                class="btn btn-danger"
                (click)="deleteArticle(article._id)"
              >
                Delete
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div *ngIf="showModal && authService.isAdmin()" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>{{ editMode ? "Edit Article" : "Add New Article" }}</h3>
      <span class="close" (click)="closeModal()">&times;</span>
    </div>

    <form (ngSubmit)="saveArticle()">
      <div class="form-group">
        <label for="designation">Designation *</label>
        <input
          type="text"
          id="designation"
          [(ngModel)]="currentArticle.designation"
          name="designation"
          required
        />
      </div>

      <div class="form-group">
        <label for="quantite">Quantity *</label>
        <input
          type="number"
          id="quantite"
          [(ngModel)]="currentArticle.quantite"
          name="quantite"
          min="0"
          required
        />
      </div>

      <div class="form-group">
        <label for="prix">Price (TND) </label>
        <input
          type="number"
          id="prix"
          [(ngModel)]="currentArticle.prix"
          name="prix"
          step="0.01"
          min="0"
          required
        />
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">
          Cancel
        </button>
        <button type="submit" class="btn btn-success">
          {{ editMode ? "Update" : "Create" }}
        </button>
      </div>
    </form>
  </div>
</div>
